fragment AllHabitFields on Habit {
  id
  tagline
  category
  details
  author {
    username
  }
  comments {
    items {
      ...AllCommentFields
    }
  }
  createdAt
  updatedAt
  ups
  downs
  _version
}

fragment AllPublicUserFields on User {
  username
  name
  avatar {
    bucket
    region
    key
    accessLevel
    cognitoId
  }
  comments {
    items {
      ...AllCommentFields
    }
  }
  habits {
    items {
      ...AllHabitFields
    }
  }
  _version
}

fragment AllPrivateUserFields on User {
  username
  name
  avatar {
    bucket
    region
    key
    accessLevel
    cognitoId
  }
  comments {
    items {
      ...AllCommentFields
    }
  }
  habits {
    items {
      ...AllHabitFields
    }
  }
  upvotedHabits
  downvotedHabits
  _version
}

fragment AllCommentFields on Comment {
  id
  by {
    username
    name
  }
  habitId
  comment
}

mutation CreateHabit($habit: CreateHabitInput!) {
  createHabit(input: $habit) {
    id
  }
}

query ListHabits($limit: Int!, $nextToken: String) {
  listHabits(limit: $limit, nextToken: $nextToken) {
    items {
      ...AllHabitFields
    }
    nextToken
  }
}

query GetHabit($habitId: ID!) {
  getHabit(id: $habitId) {
    ...AllHabitFields
  }
}

query GetUser($username: String!) {
  getUser(username: $username) {
    ...AllPublicUserFields
  }
}

query GetSelf($username: String!) {
  getUser(username: $username) {
    ...AllPrivateUserFields
  }
}

query GetComment($commentId: ID!) {
  getComment(id: $commentId) {
    ...AllCommentFields
  }
}

subscription SubscribeToUser($username: String!) {
  subscribeToUser(username: $username) {
    ...AllPublicUserFields
  }
}

mutation CreateUser($username: String!) {
  createUser(input: {
    username: $username
  }) {
    username
  }
}

mutation CreateComment($comment: String!, $habitId: ID!) {
  createComment(input: { comment: $comment, habitId: $habitId }) {
    ...AllCommentFields
  }
}

mutation UpdateUser($input: UpdateUserInput!) {
  updateUser(input: $input) {
    ...AllPrivateUserFields
  }
}

mutation UpdateHabit($input: UpdateHabitInput!) {
  updateHabit(input: $input) {
    ...AllHabitFields
  }
}

fragment AllVoteResultFields on VoteResult {
  habit {
    id
    tagline
    category
    ups
    downs
  }
  user {
    username
    upvotedHabits
    downvotedHabits
  }
}

mutation VoteForHabit($habitId: ID!, $type: VoteType!) {
  vote(habitId: $habitId, type: $type) {
    ...AllVoteResultFields
  }
}

subscription SubscribeToVotes {
  subscribeToVotes {
    ...AllVoteResultFields
  }
}

query SearchUsers($query: String!, $excludeUsername: String!, $limit: Int!) {
  searchUsers(
    filter: { and: {
      or: [
        { username: { matchPhrase: $query } },
        { name: { matchPhrasePrefix: $query } }
      ]
      username: { ne: $excludeUsername }
    } },
    limit: $limit
  ) {
    items {
      username
      name
      avatar {
        bucket
        region
        key
      }
    }
  }
}

query SearchHabits($query: String!, $limit: Int!) {
  searchHabits(
    filter: { tagline: { matchPhrasePrefix: $query } },
    limit: $limit,
  ) {
    items {
      id
      tagline
      category
    }
  }
}

